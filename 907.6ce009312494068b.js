(self.webpackChunkspear=self.webpackChunkspear||[]).push([[907],{9188:(H,F)=>{function R(s){return s.replace(/[-[\]/{}()*+?.\\^$]/g,"\\$&")}function I(s,t){var h=(void 0===t?{}:t).decimalMark,a=void 0===h?".":h;if("number"==typeof s)return s.toString();if("string"!=typeof s)return"NaN";var y=R(a),b=s.trim(),E=b.match(/^\(.*\)$|^-/),S=new RegExp("[^\\d"+y+"]|"+y+"(?=.*"+y+")|^\\D*"+y+"\\D*$","g");return""===(b=b.replace(S,"").replace(a,"."))?b="NaN":E&&(b="-"+b),b}F.He=void 0,F.He=function O(s,t){var h=(void 0===t?{}:t).decimalMark,y=I(s,{decimalMark:void 0===h?".":h});return"NaN"===y?NaN:Number(y)}},3907:(H,F,l)=>{l.r(F),l.d(F,{ATTRIBUTE_WIDGET:()=>D,Attribute:()=>K,AttributeMatcherService:()=>L,AttributePipe:()=>$,AttributeSerializerService:()=>Y,AttributeTypes:()=>d,AttributeValue:()=>N,AttributeWidget:()=>G,AttributeWidgetComponent:()=>k,AttributesBuilderComponent:()=>g,AttributesModule:()=>q,ValueComputerService:()=>z,WidgetPluginManager:()=>W,WidgetsService:()=>P});var R=l(4942),I=l(1413),O=l(4902),B=l(136),j=l(8486),v=l(5671),s=l(3144),t=l(6718),f=l(4055),h=l(3267),a=l(9401),y=l(9490),b=l(9646),E=l(5813),S=l(8154),V=l(5741),M=l(5651),T=l(9188);function A(r,i){}function m(r,i){if(1&r&&(t.\u0275\u0275elementStart(0,"div",4),t.\u0275\u0275element(1,"classifieds-ui-attribute-widget",5),t.\u0275\u0275elementEnd()),2&r){var n=i.index,e=t.\u0275\u0275nextContext();t.\u0275\u0275propertyInterpolate("formGroupName",n),t.\u0275\u0275advance(1),t.\u0275\u0275property("attribute",e.attributes[n])("widget",e.discoverWidget(e.attributes[n].widget))("appearance",e.appearance)}}function w(r,i){1&r&&(t.\u0275\u0275elementStart(0,"div")(1,"p"),t.\u0275\u0275text(2,"No attributes available for ad type. Click next to continue."),t.\u0275\u0275elementEnd()())}var D=new t.InjectionToken("AttributeWidget"),P=function(){var r=function(){function i(n){(0,v.Z)(this,i),this.widgets=n}return(0,s.Z)(i,[{key:"get",value:function(e){return this.widgets.find(function(u){return u.name===e})}}]),i}();return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275inject(D))},r.\u0275prov=t.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(),W=function(){var r=function(i){(0,B.Z)(e,i);var n=(0,j.Z)(e);function e(u,o){return(0,v.Z)(this,e),n.call(this,u,o)}return(0,s.Z)(e,[{key:"pluginDef",value:function(){return(0,b.of)(new E.PluginDef({name:"widget"}))}}]),e}(E.BasePluginManager);return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275inject(E.PluginConfigurationManager),t.\u0275\u0275inject(S.ModuleLoaderService))},r.\u0275prov=t.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"}),r}(),_=function(){var r=(0,s.Z)(function i(n){(0,v.Z)(this,i),this.viewContainerRef=n});return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275directiveInject(t.ViewContainerRef))},r.\u0275dir=t.\u0275\u0275defineDirective({type:r,selectors:[["","classifiedsUiWidgetHost",""]]}),r}(),k=function(){var r=function(){function i(n,e){(0,v.Z)(this,i),this.componentFactoryResolver=n,this.controlContainer=e,this.appearance="legacy"}return(0,s.Z)(i,[{key:"ngOnInit",value:function(){var e=this;this.widget.subscribe(function(u){var o=e.componentFactoryResolver.resolveComponentFactory(u.component),c=e.widgetHost.viewContainerRef;c.clear();var p=c.createComponent(o);p.instance.attribute=e.attribute,p.instance.appearance=e.appearance})}}]),i}();return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275directiveInject(t.ComponentFactoryResolver),t.\u0275\u0275directiveInject(a.gN))},r.\u0275cmp=t.\u0275\u0275defineComponent({type:r,selectors:[["classifieds-ui-attribute-widget"]],viewQuery:function(n,e){var u;1&n&&t.\u0275\u0275viewQuery(_,7),2&n&&t.\u0275\u0275queryRefresh(u=t.\u0275\u0275loadQuery())&&(e.widgetHost=u.first)},inputs:{widget:"widget",attribute:"attribute",appearance:"appearance"},decls:2,vars:1,consts:[[3,"formGroup"],["classifiedsUiWidgetHost",""]],template:function(n,e){1&n&&(t.\u0275\u0275elementContainerStart(0,0),t.\u0275\u0275template(1,A,0,0,"ng-template",1),t.\u0275\u0275elementContainerEnd()),2&n&&t.\u0275\u0275property("formGroup",e.controlContainer.control)},dependencies:[a.JL,a.sg,_]}),r}(),g=function(){var r=function(){function i(n,e){(0,v.Z)(this,i),this.widgetsService=n,this.wpm=e,this.attributes=[],this.appearance="legacy",this.attributesForm=new a.nJ({attributes:new a.vC([])}),this._attributeValues=[],this.onTouched=function(){}}return(0,s.Z)(i,[{key:"attributeValues",get:function(){return this._attributeValues},set:function(e){this._attributeValues=e,this.applyValues()}},{key:"attributesArray",get:function(){return this.attributesForm.get("attributes")}},{key:"ngOnChanges",value:function(e){var u=this;if(e.attributes&&(!e.attributes.previousValue||e.attributes.previousValue!==e.attributes.currentValue)){for(;0!==this.attributesArray.length;)this.attributesArray.removeAt(0);this.attributes.forEach(function(o){u.attributesArray.push(new a.nJ({name:new a.p4(o.name,a.kI.required),type:new a.p4(o.type,a.kI.required),displayName:new a.p4(o.label,a.kI.required),value:new a.p4("",o.required?a.kI.required:[]),attributes:new a.vC(o.attributes?o.attributes.map(function(c){return new a.nJ({name:new a.p4(c.name,a.kI.required),type:new a.p4(c.type,a.kI.required),displayName:new a.p4(c.label,a.kI.required),value:new a.p4("",c.required?a.kI.required:[])})}):[])}))}),this.applyValues()}}},{key:"writeValue",value:function(e){e&&(console.log("write value: ".concat(e)),this.attributesArray.setValue(e,{emitEvent:!1}))}},{key:"registerOnChange",value:function(e){this.attributesArray.valueChanges.subscribe(e)}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){e?this.attributesArray.disable():this.attributesArray.enable()}},{key:"validate",value:function(e){return this.attributesForm.valid?null:{invalidForm:{valid:!1,message:"attributes are invalid"}}}},{key:"discoverWidget",value:function(e){return this.wpm.getPlugin(e)}},{key:"applyValues",value:function(){var e=this;this.attributesArray.controls.forEach(function(u,o){var c=e.attributeValues?e.attributeValues.find(function(p){return p.name===u.get("name").value}):void 0;void 0!==c&&(u.get("value").setValue(c.value),u.updateValueAndValidity()),u.get("attributes").controls.forEach(function(p){var C=e.attributeValues&&void 0!==e.attributeValues[o]?e.attributeValues[o].attributes.find(function(x){return x.name===p.get("name").value}):void 0;void 0!==C&&(p.get("value").setValue(C.value),p.updateValueAndValidity())})})}}]),i}();return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275directiveInject(P),t.\u0275\u0275directiveInject(W))},r.\u0275cmp=t.\u0275\u0275defineComponent({type:r,selectors:[["classifieds-ui-attributes-builder"]],inputs:{attributes:"attributes",appearance:"appearance",attributeValues:"attributeValues"},features:[t.\u0275\u0275ProvidersFeature([P,{provide:a.JU,useExisting:(0,t.forwardRef)(function(){return r}),multi:!0},{provide:a.Cf,useExisting:(0,t.forwardRef)(function(){return r}),multi:!0}]),t.\u0275\u0275NgOnChangesFeature],decls:4,vars:3,consts:[[3,"formGroup"],["formArrayName","attributes",1,"attribute-fields"],["class","attribute-field-container",3,"formGroupName",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"attribute-field-container",3,"formGroupName"],[3,"attribute","widget","appearance"]],template:function(n,e){1&n&&(t.\u0275\u0275elementContainerStart(0,0),t.\u0275\u0275elementStart(1,"div",1),t.\u0275\u0275template(2,m,2,4,"div",2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd(),t.\u0275\u0275template(3,w,3,0,"div",3)),2&n&&(t.\u0275\u0275property("formGroup",e.attributesForm),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngForOf",e.attributesArray.controls),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",0==e.attributes.length))},dependencies:[f.NgForOf,f.NgIf,a.JL,a.sg,a.x0,a.CE,k]}),r}(),Z=function(){var r=(0,s.Z)(function i(n){(0,v.Z)(this,i),this.controlContainer=n,this.appearance="legacy"});return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275directiveInject(a.gN))},r.\u0275cmp=t.\u0275\u0275defineComponent({type:r,selectors:[["classifieds-ui-text-widget"]],inputs:{attribute:"attribute",appearance:"appearance"},decls:3,vars:3,consts:[[3,"formGroup"],[3,"appearance"],["matInput","","formControlName","value",3,"placeholder"]],template:function(n,e){1&n&&(t.\u0275\u0275elementContainerStart(0,0),t.\u0275\u0275elementStart(1,"mat-form-field",1),t.\u0275\u0275element(2,"input",2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd()),2&n&&(t.\u0275\u0275property("formGroup",e.controlContainer.control),t.\u0275\u0275advance(1),t.\u0275\u0275property("appearance",e.appearance),t.\u0275\u0275advance(1),t.\u0275\u0275property("placeholder",e.attribute.label))},dependencies:[a.Fj,a.JJ,a.JL,a.sg,a.u,V.v_,M.k0]}),r}(),U=function(){var r=(0,s.Z)(function i(n){(0,v.Z)(this,i),this.controlContainer=n});return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275directiveInject(a.gN))},r.\u0275cmp=t.\u0275\u0275defineComponent({type:r,selectors:[["classifieds-ui-min-max-widget"]],inputs:{attribute:"attribute"},decls:8,vars:4,consts:[[3,"formGroup"],["formArrayName","attributes"],["formGroupName","0"],["matInput","","type","number","formControlName","value",3,"placeholder"],["formGroupName","1"]],template:function(n,e){1&n&&(t.\u0275\u0275elementContainerStart(0,0),t.\u0275\u0275elementStart(1,"label"),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"div",1)(4,"mat-form-field",2),t.\u0275\u0275element(5,"input",3),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(6,"mat-form-field",4),t.\u0275\u0275element(7,"input",3),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementContainerEnd()),2&n&&(t.\u0275\u0275property("formGroup",e.controlContainer.control),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(e.attribute.label),t.\u0275\u0275advance(3),t.\u0275\u0275property("placeholder",e.attribute.attributes[0].label),t.\u0275\u0275advance(2),t.\u0275\u0275property("placeholder",e.attribute.attributes[1].label))},dependencies:[a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,a.x0,a.CE,V.v_,M.k0]}),r}(),L=function(){var r=function(){function i(){(0,v.Z)(this,i)}return(0,s.Z)(i,[{key:"getComputedValue",value:function(e,u){var o=u&&u.length>0&&this.matchAttribute(e,u);if(o)return o.computedValue}},{key:"getValue",value:function(e,u){var o=u&&u.length>0&&this.matchAttribute(e,u);if(o)return o.value}},{key:"matchAttribute",value:function(e,u){for(var o=u.length,c=0;c<o;c++)if(u[c].attributes&&u[c].attributes.length>0){if(this.matchAttribute(e,u[c].attributes))return u[c]}else if(e===u[c].name)return u[c]}}]),i}();return r.\u0275fac=function(n){return new(n||r)},r.\u0275prov=t.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"}),r}(),$=function(){var r=function(){function i(n){(0,v.Z)(this,i),this.attributeMatcher=n}return(0,s.Z)(i,[{key:"transform",value:function(e,u){return this.attributeMatcher.getComputedValue(u,e)||""}}]),i}();return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275directiveInject(L,16))},r.\u0275pipe=t.\u0275\u0275definePipe({name:"attribute",type:r,pure:!0}),r}(),d=function(){return(d=d||{})[d.Number=0]="Number",d[d.Text=1]="Text",d[d.Complex=2]="Complex",d[d.Float=3]="Float",d[d.Array=4]="Array",d[d.Bool=5]="Bool",d[d.Date=6]="Date",d}(),G=function(r){(0,B.Z)(n,r);var i=(0,j.Z)(n);function n(e){var u;return(0,v.Z)(this,n),u=i.call(this,e),e&&(u.name=u.id,u.schema=e.schema?new K(e.schema):void 0,u.component=e.component),u}return(0,s.Z)(n)}(E.Plugin),K=(0,s.Z)(function r(i){(0,v.Z)(this,r),this.attributes=[],i&&(this.name=i.name,this.widget=void 0!==i.widget?i.widget:"text",this.type=i.type,this.label=i.label,this.required=i.required,this.options=i.options,i.attributes&&(this.attributes=i.attributes.map(function(n){return new r(n)})))}),N=(0,s.Z)(function r(i){(0,v.Z)(this,r),this.attributes=[],i&&(this.name=i.name,this.displayName=i.displayName,this.type=i.type,this.value=i.value,this.intValue=i.intValue,this.computedValue=i.computedValue,i.attributes&&(Array.isArray(i.attributes)?this.attributes=i.attributes.reduce(function(n,e){return void 0===e._store||e._store?[].concat((0,O.Z)(n),[new r(e)]):n},[]):(void 0===i.attributes._store||i.attributes._store)&&(this.attributes=[i.attributes])),i.value&&"object"==typeof i.value?(this.value=void 0,this.type=d.Complex,i.value.attributes.reduce(function(n,e){return void 0===e._store||e._store?[].concat((0,O.Z)(n),[new r(e)]):n},[])):this.value=i.value)}),Q=function(){var i=new K({name:"",type:d.Text,label:"",required:!1,widget:"text",options:{},attributes:[]});return new G({id:"text",name:"text",title:"Text",component:Z,schema:i})},X=function(){return new G({id:"minmax",name:"minmax",title:"MinMax",component:U,schema:void 0})},q=function(){var r=(0,s.Z)(function i(n,e){(0,v.Z)(this,i),n.forEach(function(u){return e.register(u)})});return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275inject(D),t.\u0275\u0275inject(W))},r.\u0275mod=t.\u0275\u0275defineNgModule({type:r}),r.\u0275inj=t.\u0275\u0275defineInjector({providers:[{provide:D,useFactory:Q,multi:!0},{provide:D,useFactory:X,multi:!0}],imports:[f.CommonModule,a.UX,y.MaterialModule,h.HttpClientJsonpModule]}),r}(),z=function(){var r=function(){function i(){(0,v.Z)(this,i)}return(0,s.Z)(i,[{key:"compute",value:function(e){var u=this,o=[];return e.forEach(function(c){return o.push(u.computeAttribute(c))}),o}},{key:"computeAttribute",value:function(e){var u=this.resolveComputedValue(e.value,e.type);return new N((0,I.Z)((0,I.Z)({},e),{},e.attributes&&e.attributes.length>0?{computedValue:u,attributes:this.compute(e.attributes)}:{computedValue:u}))}},{key:"resolveComputedValue",value:function(e,u){var o;return u===d.Number?(o=(0,T.He)(e.trim()))&&isNaN(o)&&(o=void 0):o=e.trim(),void 0===o?o:"".concat(o)}}]),i}();return r.\u0275fac=function(n){return new(n||r)},r.\u0275prov=t.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"}),r}(),Y=function(){var r=function(){function i(n){(0,v.Z)(this,i),this.valueComputer=n}return(0,s.Z)(i,[{key:"serialize",value:function(e,u){var o=typeof e;if("object"!==o)return new N({name:u,type:"string"!==o?"boolean"!==o?d.Number:d.Bool:d.Text,displayName:u,value:"".concat(e),intValue:void 0,computedValue:this.valueComputer.resolveComputedValue("".concat(e),"string"!==o?"boolean"!==o?d.Number:d.Bool:d.Text),attributes:[]});if(Array.isArray(e)&&("attributes"===u||"settings"===u))return new N({name:u,type:d.Complex,displayName:u,value:void 0,intValue:void 0,computedValue:void 0,attributes:e});if(Array.isArray(e)){for(var c=e.length,p=[],C=0;C<c;C++)p.push(this.serialize(e[C],"".concat(C)));return new N({name:u,type:d.Array,displayName:u,value:void 0,intValue:void 0,computedValue:void 0,attributes:p})}if(e instanceof Date)return new N({name:u,type:d.Date,displayName:u,value:e.toJSON(),intValue:void 0,computedValue:e.toJSON(),attributes:[]});var x=[];for(var J in e)x.push(this.serialize(e[J],J));return new N({name:u,type:d.Complex,displayName:u,value:void 0,intValue:void 0,computedValue:void 0,attributes:x})}},{key:"deserializeAsObject",value:function(e){var u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.deserialize(new N({name:"root",type:d.Complex,displayName:"root",value:void 0,computedValue:void 0,intValue:0,attributes:e}),u)}},{key:"deserialize",value:function(e){var o,c,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e.type){case d.Complex:if(u||"attributes"!==e.name&&"settings"!==e.name){c=e.attributes.length;for(var p=0;p<c;p++)o=(0,I.Z)((0,I.Z)({},o),{},(0,R.Z)({},e.attributes[p].name,this.deserialize(e.attributes[p])))}else o=e.attributes.map(function(x){return new N(x)});break;case d.Bool:o=void 0!==e.value?["1","true","on"].findIndex(function(x){return x===e.value})>-1:void 0;break;case d.Number:case d.Float:o=void 0!==e.value&&""!==e.value&&"undefined"!==e.value?"0"!==e.value?(0,T.He)(e.value.trim()):0:void 0;break;case d.Text:o=e.value;break;case d.Array:if(u||"attributes"!==e.name&&"settings"!==e.name){c=e.attributes.length,o=[];for(var C=0;C<c;C++)o=[].concat((0,O.Z)(o),[this.deserialize(e.attributes[C])])}else o=e.attributes.map(function(x){return new N(x)});break;case d.Date:o=void 0!==e.value&&""!==e.value?new Date(e.value):void 0}return o}},{key:"convertToGroup",value:function(e){var u=this,o=new a.nJ({name:new a.p4(e.name,a.kI.required),type:new a.p4(e.type,a.kI.required),displayName:new a.p4(e.displayName,a.kI.required),value:new a.p4(e.value,a.kI.required),computedValue:new a.p4(e.value,a.kI.required),attributes:new a.vC([])});return e.attributes&&e.attributes.length>0&&e.attributes.forEach(function(c){o.get("attributes").push(u.convertToGroup(c))}),o}}]),i}();return r.\u0275fac=function(n){return new(n||r)(t.\u0275\u0275inject(z))},r.\u0275prov=t.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"}),r}()}}]);